<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>サーバー設定管理 - α鯖</title>
  <style>
    :root{--accent:#2b8a3e;--muted:#6b7280;--bg:#f6f8fa;--card:#fff;--maxw:1100px}
    *{box-sizing:border-box}
    body{margin:0;font-family:"Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto;background:var(--bg);color:#111}
    header{background:linear-gradient(180deg,#0b1220,#0f172a);color:#fff;padding:18px;text-align:center}
    main{max-width:var(--maxw);margin:18px auto;padding:18px}
    .panel{background:var(--card);padding:14px;border-radius:10px;border:1px solid #e6eef6;margin-bottom:14px}
    label{display:block;font-weight:700;margin-top:10px}
    input[type="text"], input[type="url"], input[type="number"], textarea, select{width:100%;padding:8px;border-radius:8px;border:1px solid #e6eef6;margin-top:6px}
    textarea{min-height:100px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:12px}
    .row{display:flex;gap:8px}
    .btn{padding:8px 12px;border-radius:8px;border:none;background:var(--accent);color:#fff;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid #e6eef6}
    .btn.warn{background:#d9534f}
    .small{font-size:0.9rem;color:var(--muted);margin-top:8px}
    .copy-btn{padding:6px 8px;border-radius:6px;border:1px solid rgba(0,0,0,0.06);background:#fff;cursor:pointer}
    .status-badge{display:inline-block;padding:6px 10px;border-radius:999px;color:#fff;font-weight:700}
    .status-online{background:#16a34a}
    .status-maint{background:#f59e0b}
    .status-off{background:#ef4444}
    .meta{color:var(--muted);font-size:0.9rem}
    .note{font-size:0.9rem;color:var(--muted);margin-top:8px}
    .preview{border-radius:8px;overflow:hidden;border:1px solid #eef2f6;padding:8px;background:#fff}
    @media (max-width:980px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <header>
    <h1>サーバー情報 管理</h1>
    <p style="margin:6px 0 0;opacity:0.9">Java / 統合（Bedrock）それぞれの接続情報（IP・ポート）やリソース、バージョン、Discord等を編集します。</p>
  </header>

  <main>
    <section class="panel">
      <h2>基本設定</h2>
      <div class="grid">
        <div>
          <label for="srv-name">サーバー表示名</label>
          <input id="srv-name" type="text" placeholder="例：αサーバー">

          <label for="srv-status">稼働状況</label>
          <select id="srv-status">
            <option value="online">オンライン</option>
            <option value="maintenance">メンテナンス中</option>
            <option value="offline">オフライン</option>
          </select>

          <label for="srv-location">サーバー所在地（目安）</label>
          <input id="srv-location" type="text" placeholder="例：JP - Tokyo">

          <label for="srv-maxplayers">同時接続上限（最大プレイヤー数）</label>
          <input id="srv-maxplayers" type="number" min="0" placeholder="例：100">

          <label for="srv-whitelist">ホワイトリスト</label>
          <select id="srv-whitelist">
            <option value="false">無効</option>
            <option value="true">有効</option>
          </select>

          <label for="srv-notes">接続補足（SRVやプロキシ等、改行可）</label>
          <textarea id="srv-notes" placeholder="接続時の注意点や補足を記載"></textarea>
        </div>

        <aside>
          <label for="srv-discord">公式 Discord 招待URL</label>
          <input id="srv-discord" type="url" placeholder="https://discord.gg/xxxxx">

          <label for="srv-website">公式サイト / サポートURL</label>
          <input id="srv-website" type="url" placeholder="https://">

          <label for="srv-contact">管理者連絡先（任意）</label>
          <input id="srv-contact" type="text" placeholder="例：admin@example.jp">

          <label for="srv-banner">ヘッダー画像（任意）</label>
          <input id="srv-banner" type="file" accept="image/*">
          <div id="srv-banner-preview" class="preview" style="margin-top:8px"></div>

          <div class="small">保存先: <code>alpha_server_v1</code></div>
        </aside>
      </div>

      <div style="margin-top:12px" class="row">
        <button id="save-basic" class="btn">保存</button>
        <button id="reset-basic" class="btn ghost">リセット</button>
      </div>
    </section>

    <section class="panel">
      <h2>接続情報（Java / 統合）</h2>
      <div class="grid">
        <div>
          <label>Java版（Java Edition）</label>
          <label for="java-ip">IP / ドメイン</label>
          <input id="java-ip" type="text" placeholder="例：play.example.jp">
          <label for="java-port">ポート（省略可）</label>
          <input id="java-port" type="text" placeholder="例：25565">
          <div style="margin-top:6px" class="row">
            <button class="copy-btn" data-copy-target="java-ip">IP をコピー</button>
            <button class="copy-btn" data-copy-target="java-port">ポートをコピー</button>
            <button id="gen-java-srv" class="btn ghost" type="button">SRV 設定メモを生成</button>
          </div>

          <label style="margin-top:12px">Minecraft サーバーバージョン</label>
          <input id="mc-version" type="text" placeholder="例：1.20.4">

          <label for="mc-compatible">対応クライアント（範囲）</label>
          <input id="mc-compatible" type="text" placeholder="例：1.20.x / 1.19-1.20">

          <label style="margin-top:12px">クライアント（推奨）</label>
          <input id="mc-client" type="text" placeholder="例：Java 1.20.4 推奨">
        </div>

        <aside>
          <label>統合版（Bedrock / 統合）</label>
          <label for="bedrock-ip">IP / ドメイン</label>
          <input id="bedrock-ip" type="text" placeholder="例：bedrock.example.jp">
          <label for="bedrock-port">ポート（省略可）</label>
          <input id="bedrock-port" type="text" placeholder="例：19132">
          <div style="margin-top:6px" class="row">
            <button class="copy-btn" data-copy-target="bedrock-ip">IP をコピー</button>
            <button class="copy-btn" data-copy-target="bedrock-port">ポートをコピー</button>
          </div>

          <label style="margin-top:12px">接続方法補足</label>
          <textarea id="bedrock-notes" placeholder="統合版の接続補足（例：ポート指定、NAT注意）"></textarea>
        </aside>
      </div>

      <div style="margin-top:12px" class="row">
        <button id="save-connect" class="btn">接続情報を保存</button>
        <button id="reset-connect" class="btn ghost">リセット</button>
      </div>
    </section>

    <section class="panel">
      <h2>リソース / ハードウェア情報</h2>
      <div class="grid">
        <div>
          <label for="srv-maxmem">最大メモリ（例：8GB）</label>
          <input id="srv-maxmem" type="text" placeholder="例：8GB">

          <label for="srv-cpu">CPU（型番・簡潔に）</label>
          <input id="srv-cpu" type="text" placeholder="例：Intel Xeon E-2276G">

          <label for="srv-cores">コア / スレッド</label>
          <input id="srv-cores" type="text" placeholder="例：8コア / 16スレッド">

          <label for="srv-storage">ディスク（容量・種類）</label>
          <input id="srv-storage" type="text" placeholder="例：NVMe 500GB">

          <label for="srv-network">ネットワーク帯域（目安）</label>
          <input id="srv-network" type="text" placeholder="例：1Gbps / 帯域保証なし">
        </div>

        <aside>
          <label for="srv-maint-next">次回メンテ予定（任意）</label>
          <input id="srv-maint-next" type="text" placeholder="例：2026-01-15 10:00 JST">

          <label for="srv-maint-note">メンテ備考</label>
          <textarea id="srv-maint-note" placeholder="メンテの詳細や影響範囲"></textarea>

          <label for="srv-status-note">運用メモ（公開/非公開）</label>
          <textarea id="srv-status-note" placeholder="運営向けメモ（公開する場合は注意）"></textarea>
        </aside>
      </div>

      <div style="margin-top:12px" class="row">
        <button id="save-resource" class="btn">リソース情報を保存</button>
        <button id="reset-resource" class="btn ghost">リセット</button>
      </div>
    </section>

    <section class="panel">
      <h2>エクスポート / インポート</h2>
      <div class="row">
        <button id="export-server" class="btn ghost">サーバー設定をエクスポート</button>
        <button id="import-server-btn" class="btn ghost">インポート</button>
        <input id="import-server-file" type="file" accept="application/json" style="display:none">
        <button id="clear-server" class="btn warn">全て初期化</button>
      </div>
      <div class="note">エクスポートは JSON ファイルを生成します。インポートは同形式の JSON を読み込みます。</div>
    </section>
  </main>

  <script>
    (function(){
      const KEY = 'alpha_server_v1';

      // DOM refs
      const fields = {
        name: document.getElementById('srv-name'),
        status: document.getElementById('srv-status'),
        location: document.getElementById('srv-location'),
        maxplayers: document.getElementById('srv-maxplayers'),
        whitelist: document.getElementById('srv-whitelist'),
        notes: document.getElementById('srv-notes'),
        discord: document.getElementById('srv-discord'),
        website: document.getElementById('srv-website'),
        contact: document.getElementById('srv-contact'),
        bannerFile: document.getElementById('srv-banner'),
        bannerPreview: document.getElementById('srv-banner-preview'),

        javaIp: document.getElementById('java-ip'),
        javaPort: document.getElementById('java-port'),
        mcVersion: document.getElementById('mc-version'),
        mcCompatible: document.getElementById('mc-compatible'),
        mcClient: document.getElementById('mc-client'),

        bedrockIp: document.getElementById('bedrock-ip'),
        bedrockPort: document.getElementById('bedrock-port'),
        bedrockNotes: document.getElementById('bedrock-notes'),

        maxmem: document.getElementById('srv-maxmem'),
        cpu: document.getElementById('srv-cpu'),
        cores: document.getElementById('srv-cores'),
        storage: document.getElementById('srv-storage'),
        network: document.getElementById('srv-network'),
        maintNext: document.getElementById('srv-maint-next'),
        maintNote: document.getElementById('srv-maint-note'),
        statusNote: document.getElementById('srv-status-note')
      };

      const saveBasicBtn = document.getElementById('save-basic');
      const resetBasicBtn = document.getElementById('reset-basic');
      const saveConnectBtn = document.getElementById('save-connect');
      const resetConnectBtn = document.getElementById('reset-connect');
      const saveResourceBtn = document.getElementById('save-resource');
      const resetResourceBtn = document.getElementById('reset-resource');

      const exportBtn = document.getElementById('export-server');
      const importBtn = document.getElementById('import-server-btn');
      const importFile = document.getElementById('import-server-file');
      const clearAllBtn = document.getElementById('clear-server');

      // copy buttons
      document.querySelectorAll('.copy-btn').forEach(b=>{
        b.addEventListener('click', ()=>{
          const target = b.getAttribute('data-copy-target');
          const el = document.getElementById(target);
          if(!el) return;
          navigator.clipboard?.writeText(el.value || '').then(()=> {
            const orig = b.textContent;
            b.textContent = 'コピーしました';
            setTimeout(()=> b.textContent = orig, 1200);
          }).catch(()=> alert('コピーに失敗しました'));
        });
      });

      // SRV helper
      document.getElementById('gen-java-srv').addEventListener('click', ()=>{
        const ip = fields.javaIp.value.trim();
        const port = fields.javaPort.value.trim() || '25565';
        if(!ip){ alert('Java IP を入力してください'); return; }
        const msg = `SRV レコード例:\n_service._tcp.example.com -> target: ${ip}, port: ${port}\n（DNS 管理者に依頼してください）`;
        alert(msg);
      });

      // banner upload
      fields.bannerFile.addEventListener('change', async (e)=>{
        const f = e.target.files && e.target.files[0];
        if(!f) return;
        try{
          fields.bannerPreview.textContent = '処理中…';
          const dataUrl = await imageFileToCompressedDataURL(f, 1600, 0.8);
          fields.bannerPreview.innerHTML = `<img src="${dataUrl}" alt="banner" style="width:100%;border-radius:8px">`;
          fields._bannerData = dataUrl;
        }catch(err){
          console.error(err);
          alert('画像処理に失敗しました');
          fields.bannerPreview.textContent = '';
          fields._bannerData = '';
        } finally {
          fields.bannerFile.value = '';
        }
      });

      // image helper
      function imageFileToCompressedDataURL(file, maxWidth = 1400, quality = 0.8){
        return new Promise((resolve,reject)=>{
          const reader = new FileReader();
          const img = new Image();
          reader.onload = ()=> {
            img.onload = ()=>{
              try{
                const ratio = img.width / img.height || 1;
                let targetW = img.width;
                if(img.width > maxWidth) targetW = maxWidth;
                const targetH = Math.round(targetW / ratio);
                const canvas = document.createElement('canvas');
                canvas.width = targetW; canvas.height = targetH;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#ffffff'; ctx.fillRect(0,0,canvas.width,canvas.height);
                ctx.drawImage(img,0,0,canvas.width,canvas.height);
                const dataUrl = canvas.toDataURL('image/jpeg', quality);
                resolve(dataUrl);
              }catch(err){ reject(err); }
            };
            img.onerror = ()=> reject(new Error('画像読み込み失敗'));
            img.src = reader.result;
          };
          reader.onerror = ()=> reject(new Error('ファイル読み込み失敗'));
          reader.readAsDataURL(file);
        });
      }

      // load/save
      function load(){
        try{
          const raw = localStorage.getItem(KEY);
          return raw ? JSON.parse(raw) : {};
        }catch(e){ return {}; }
      }
      function save(obj){
        localStorage.setItem(KEY, JSON.stringify(obj));
        try{ window.dispatchEvent(new StorageEvent('storage', { key: KEY })); }catch(e){}
      }

      function populate(){
        const s = load();
        fields.name.value = s.name || '';
        fields.status.value = s.status || 'online';
        fields.location.value = s.location || '';
        fields.maxplayers.value = s.maxPlayers || '';
        fields.whitelist.value = s.whitelist ? 'true' : 'false';
        fields.notes.value = s.notes || '';
        fields.discord.value = s.discord || '';
        fields.website.value = s.website || '';
        fields.contact.value = s.contact || '';
        if(s.banner) fields.bannerPreview.innerHTML = `<img src="${s.banner}" alt="banner" style="width:100%;border-radius:8px">`;
        fields._bannerData = s.banner || '';

        fields.javaIp.value = (s.java && s.java.ip) || '';
        fields.javaPort.value = (s.java && s.java.port) || '';
        fields.mcVersion.value = s.minecraftVersion || '';
        fields.mcCompatible.value = s.compatibleClients || '';
        fields.mcClient.value = s.client || '';

        fields.bedrockIp.value = (s.bedrock && s.bedrock.ip) || '';
        fields.bedrockPort.value = (s.bedrock && s.bedrock.port) || '';
        fields.bedrockNotes.value = (s.bedrock && s.bedrock.notes) || '';

        fields.maxmem.value = s.maxMemory || '';
        fields.cpu.value = s.cpu || '';
        fields.cores.value = s.cores || '';
        fields.storage.value = s.storage || '';
        fields.network.value = s.network || '';
        fields.maintNext.value = (s.maintenance && s.maintenance.next) || '';
        fields.maintNote.value = (s.maintenance && s.maintenance.note) || '';
        fields.statusNote.value = s.statusNote || '';
      }

      // save handlers
      saveBasicBtn.addEventListener('click', ()=>{
        const s = load();
        s.name = fields.name.value.trim();
        s.status = fields.status.value;
        s.location = fields.location.value.trim();
        s.maxPlayers = fields.maxplayers.value ? Number(fields.maxplayers.value) : '';
        s.whitelist = fields.whitelist.value === 'true';
        s.notes = fields.notes.value.trim();
        s.discord = fields.discord.value.trim();
        s.website = fields.website.value.trim();
        s.contact = fields.contact.value.trim();
        s.banner = fields._bannerData || s.banner || '';
        s.updatedAt = Date.now();
        save(s);
        populate();
        alert('基本設定を保存しました');
      });

      saveConnectBtn.addEventListener('click', ()=>{
        const s = load();
        s.java = s.java || {};
        s.java.ip = fields.javaIp.value.trim();
        s.java.port = fields.javaPort.value.trim();
        s.minecraftVersion = fields.mcVersion.value.trim();
        s.compatibleClients = fields.mcCompatible.value.trim();
        s.client = fields.mcClient.value.trim();
        s.bedrock = s.bedrock || {};
        s.bedrock.ip = fields.bedrockIp.value.trim();
        s.bedrock.port = fields.bedrockPort.value.trim();
        s.bedrock.notes = fields.bedrockNotes.value.trim();
        s.updatedAt = Date.now();
        save(s);
        populate();
        alert('接続情報を保存しました');
      });

      saveResourceBtn.addEventListener('click', ()=>{
        const s = load();
        s.maxMemory = fields.maxmem.value.trim();
        s.cpu = fields.cpu.value.trim();
        s.cores = fields.cores.value.trim();
        s.storage = fields.storage.value.trim();
        s.network = fields.network.value.trim();
        s.maintenance = s.maintenance || {};
        s.maintenance.next = fields.maintNext.value.trim();
        s.maintenance.note = fields.maintNote.value.trim();
        s.statusNote = fields.statusNote.value.trim();
        s.updatedAt = Date.now();
        save(s);
        populate();
        alert('リソース情報を保存しました');
      });

      // reset handlers
      resetBasicBtn.addEventListener('click', ()=> { if(confirm('基本設定をリセットしますか？')){ const s = load(); s.name=''; s.status='online'; s.location=''; s.maxPlayers=''; s.whitelist=false; s.notes=''; s.discord=''; s.website=''; s.contact=''; s.banner=''; save(s); populate(); }});
      resetConnectBtn.addEventListener('click', ()=> { if(confirm('接続情報をリセットしますか？')){ const s = load(); s.java={}; s.bedrock={}; s.minecraftVersion=''; s.compatibleClients=''; s.client=''; save(s); populate(); }});
      resetResourceBtn.addEventListener('click', ()=> { if(confirm('リソース情報をリセットしますか？')){ const s = load(); s.maxMemory=''; s.cpu=''; s.cores=''; s.storage=''; s.network=''; s.maintenance={}; s.statusNote=''; save(s); populate(); }});

      // export/import
      exportBtn.addEventListener('click', ()=>{
        const data = JSON.stringify(load(), null, 2);
        const blob = new Blob([data], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'alpha_server_export.json';
        document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      });

      importBtn.addEventListener('click', ()=> importFile.click());
      importFile.addEventListener('change', (e)=>{
        const f = e.target.files && e.target.files[0];
        if(!f) return;
        const reader = new FileReader();
        reader.onload = ()=> {
          try{
            const parsed = JSON.parse(reader.result);
            if(typeof parsed !== 'object') throw new Error('不正な形式');
            save(parsed);
            populate();
            alert('インポート完了');
          }catch(err){ alert('インポートに失敗しました：' + err.message); }
        };
        reader.readAsText(f);
      });

      clearAllBtn.addEventListener('click', ()=>{
        if(!confirm('全てのサーバー設定を初期化しますか？ この操作は取り消せません。')) return;
        localStorage.removeItem(KEY);
        populate();
        alert('初期化しました');
      });

      // init
      populate();

      // storage sync
      window.addEventListener('storage', (e)=>{
        if(e.key === KEY) populate();
      });

    })();
  </script>
</body>
</html>これで保存した情報が
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>α鯖 - Minecraft Server</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Poppins:wght@600;800&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="css/style.css">

  <!-- Favicon -->
  <link rel="icon" href="img/favicon.png" type="image/png">
</head>
<body>
    <header class="site-banner" role="banner" style="width:100%;background:linear-gradient(90deg,#0f172a,#0b1220);color:#fff;position:sticky;top:0;z-index:1000;box-shadow:0 2px 6px rgba(0,0,0,0.2);">
    <a href="#main-content" class="skip-link" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">コンテンツへスキップ</a>

    <div class="banner-inner" style="max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:10px 16px;gap:12px;box-sizing:border-box;">
        <!-- 左グループ -->
        <div class="left-group" style="display:flex;gap:8px;align-items:center;">
        <a href="https://discord.gg/m3tSJ3QCVP" target="_blank" rel="noopener noreferrer" aria-label="Discord" style="display:inline-flex;align-items:center;gap:8px;color:#e6eef8;text-decoration:none;padding:6px 10px;border-radius:6px;font-weight:600;font-size:14px;">
            <!-- 必要ならここにSVG -->
            <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" style="display:block;fill:currentColor;"><!-- ... --></svg>
            <span>Discord</span>
        </a>


        </div>

        <!-- 中央ブランド -->
        <div class="brand" style="display:flex;align-items:center;gap:8px;margin:auto;">
        <img src="./img/server-icon.png" alt="α鯖アイコン" class="brand-icon" style="width:36px;height:36px;">
        <span class="brand-text" style="font-size:18px;font-weight:800;color:#fff;">α鯖</span>
        </div>

        <!-- 右グループ（ナビ） -->
        <nav class="right-group" role="navigation" aria-label="サイトナビゲーション" style="display:flex;align-items:center;gap:12px;">
        <button class="hamburger" aria-expanded="false" aria-controls="nav-list" aria-label="メニュー" style="display:none;background:none;border:0;padding:6px;cursor:pointer;">
            <span style="display:block;width:20px;height:2px;background:#fff;margin:4px 0;border-radius:2px;"></span>
            <span style="display:block;width:20px;height:2px;background:#fff;margin:4px 0;border-radius:2px;"></span>
            <span style="display:block;width:20px;height:2px;background:#fff;margin:4px 0;border-radius:2px;"></span>
        </button>

        <ul id="nav-list" class="nav-list" aria-hidden="true" style="display:flex;gap:10px;list-style:none;margin:0;padding:0;align-items:center;">
            <li><a href="./index.html" class="nav-link" style="color:#dbeafe;text-decoration:none;padding:8px 10px;border-radius:6px;font-weight:600;">トップ</a></li>
            <li><a href="./events.html" class="nav-link" style="color:#dbeafe;text-decoration:none;padding:8px 10px;border-radius:6px;font-weight:600;">イベント</a></li>
            <li><a href="./gallery.html" class="nav-link" style="color:#dbeafe;text-decoration:none;padding:8px 10px;border-radius:6px;font-weight:600;">ギャラリー</a></li>
            <li><a href="./plugins.html" class="nav-link" style="color:#dbeafe;text-decoration:none;padding:8px 10px;border-radius:6px;font-weight:600;">プラグイン</a></li>
            <li><a href="./rules.html" class="nav-link" style="color:#dbeafe;text-decoration:none;padding:8px 10px;border-radius:6px;font-weight:600;">ルール</a></li>
            <li><a href="./worlds.html" class="nav-link" style="color:#dbeafe;text-decoration:none;padding:8px 10px;border-radius:6px;font-weight:600;">ワールド</a></li>
            <li><a href="./donate.html" class="nav-link donate" style="background:linear-gradient(90deg,#ff7a18,#ff3d00);color:#fff;padding:8px 12px;border-radius:8px;font-weight:700;text-decoration:none;box-shadow:0 2px 8px rgba(255,61,0,0.2);">寄付</a></li>
        </ul>
        </nav>
    </div>
    </header>
  <!-- 固定サイト背景 -->
  <div class="site-bg" aria-hidden="true"></div>

  <!-- HERO -->
  <header class="hero" role="banner" aria-label="α鯖 ヒーロー">
    <img src="img/server-bg.jpg" alt="サーバー背景" class="hero-bg" />
    <div class="hero-overlay"></div>

    <div class="hero-inner">
      <img src="img/server-icon.png" alt="α鯖アイコン" class="server-icon" />
      <h1 class="server-title" aria-hidden="true">α鯖</h1>
      <p class="server-sub">自由と冒険がここにある</p>
      <div class="hero-cta">
        <a class="cta-btn" href="#server-info">参加方法</a>
        <a class="cta-btn ghost" href="#rules">ルール</a>
        <a class="cta-btn ghost" href="#events">イベント</a>
      </div>
    </div>
  </header>

  <main>

    <!-- EVENTS（直近3件） -->
    <section id="events" class="events" aria-labelledby="events-heading">
      <h2 id="events-heading">最新イベント</h2>
      <div class="event-list" id="event-list">
        <!-- JS がここを埋めます（直近3件） -->
      </div>

      <!-- 右下に重ねる「全てのイベントを見る」ボタン（イベントセクション用） -->
      <div class="events-overlay">
        <a href="events.html" class="btn events-all" aria-label="全てのイベントを見る">全てのイベントを見る</a>
      </div>
    </section>

    <!-- GALLERY（トップ用：最新5件） -->
    <section class="gallery-top" aria-labelledby="gallery-heading">
      <h2 id="gallery-heading">ギャラリー（最新）</h2>

      <!-- 最新5件をここに挿入 -->
      <div class="top-gallery" id="top-gallery" aria-live="polite">
        <!-- JS がここを埋める。各サムネは <a href="gallery.html"> でギャラリーページへ遷移 -->
      </div>

      <!-- 右下に重ねる「全てのギャラリーを見る」ボタン -->
      <div class="top-gallery-overlay">
        <a href="gallery.html" class="btn top-gallery-all" aria-label="全てのギャラリーを見る">全てのギャラリーを見る</a>
      </div>
    </section>

    <!-- WORLDS（縦並びリスト） -->
    <section class="worlds" aria-labelledby="worlds-heading">
    <h2 id="worlds-heading">ワールド紹介</h2>

    <div id="worlds-vertical" class="worlds-vertical" aria-live="polite">
        <!-- JS がここを埋めます -->
    </div>

    <div id="worlds-empty" style="color:#666;margin-top:12px;display:none">
        ワールドはまだ登録されていません。管理画面で追加してください。
    </div>
    </section>

    <style>
    /* 縦並びカード */
    .worlds-vertical{
        display:flex;
        flex-direction:column;
        gap:18px;
        margin-top:12px;
    }

    .world-vertical-card{
        width:100%;
        min-height:160px;
        border-radius:12px;
        overflow:hidden;
        position:relative;
        cursor:pointer;
        background-size:cover;
        background-position:center;
        box-shadow:0 8px 24px rgba(10,20,30,0.06);
        transition:transform .14s ease, box-shadow .14s ease;
        display:flex;
        align-items:stretch;
    }
    .world-vertical-card:hover{ transform:translateY(-6px); box-shadow:0 20px 48px rgba(10,20,30,0.12); }

    .world-vertical-overlay{
        position:absolute; inset:0;
        background:linear-gradient(180deg, rgba(0,0,0,0.28), rgba(0,0,0,0.18));
        pointer-events:none;
    }

    .world-vertical-inner{
        position:relative;
        z-index:2;
        display:flex;
        gap:18px;
        width:100%;
        padding:18px;
        align-items:center;
    }

    .world-vertical-thumb{
        flex:0 0 320px;
        height:124px;
        border-radius:8px;
        object-fit:cover;
        background:#f1f5f9;
        box-shadow:inset 0 0 0 1px rgba(255,255,255,0.02);
    }

    .world-vertical-text{
        flex:1;
        color:#fff;
        display:flex;
        flex-direction:column;
        justify-content:center;
        gap:8px;
    }
    .world-vertical-text h3{margin:0;font-size:1.25rem;line-height:1.1}
    .world-vertical-text p{margin:0;color:rgba(255,255,255,0.95);font-size:1rem;line-height:1.4}

    @media (max-width:900px){
        .world-vertical-inner{flex-direction:column;align-items:flex-start;padding:14px}
        .world-vertical-thumb{width:100%;height:160px;flex:0 0 auto}
    }
    </style>

    <script>
    (function(){
    const STORAGE_KEY = 'alpha_worlds_v1';
    const SELECT_KEY = 'alpha_worlds_selected';
    const container = document.getElementById('worlds-vertical');
    const emptyEl = document.getElementById('worlds-empty');

    function loadWorlds(){
        try{
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
        }catch(e){
        console.error('worlds load error', e);
        return [];
        }
    }

    function escapeHtml(s){
        if(!s) return '';
        return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    function pickImage(w){
        if(w.thumbnail) return w.thumbnail;
        if(w.background) return w.background;
        if(Array.isArray(w.chapters) && w.chapters.length && w.chapters[0].image) return w.chapters[0].image;
        return 'img/worlds/default.jpg';
    }

    function render(){
        const worlds = loadWorlds();
        container.innerHTML = '';
        if(!worlds || worlds.length === 0){
        emptyEl.style.display = 'block';
        return;
        }
        emptyEl.style.display = 'none';

        worlds.forEach(w=>{
        const card = document.createElement('article');
        card.className = 'world-vertical-card';
        const img = pickImage(w);
        card.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.0), rgba(0,0,0,0.0)), url('${escapeHtml(img)}')`;
        card.setAttribute('role','button');
        card.setAttribute('aria-label', w.name || 'ワールド');

        const overlay = document.createElement('div'); overlay.className = 'world-vertical-overlay';
        const inner = document.createElement('div'); inner.className = 'world-vertical-inner';

        const thumb = document.createElement('img');
        thumb.className = 'world-vertical-thumb';
        thumb.src = escapeHtml(img);
        thumb.alt = w.name || 'ワールド画像';

        const textWrap = document.createElement('div'); textWrap.className = 'world-vertical-text';
        const title = document.createElement('h3'); title.innerHTML = escapeHtml(w.name || '無題のワールド');
        const desc = document.createElement('p'); desc.innerHTML = escapeHtml(w.desc || w.longDesc || '');
        textWrap.appendChild(title); textWrap.appendChild(desc);

        inner.appendChild(thumb);
        inner.appendChild(textWrap);

        card.appendChild(overlay);
        card.appendChild(inner);

        card.addEventListener('click', ()=>{
            try{ localStorage.setItem(SELECT_KEY, w.id); }catch(e){ console.error(e); }
            window.location.href = 'worlds.html';
        });

        container.appendChild(card);
        });
    }

    render();

    window.addEventListener('storage', (e)=>{
        if(e.key === STORAGE_KEY || e.key === SELECT_KEY){
        render();
        }
    });
    })();
    </script>


    <!-- RULES -->
    <section id="rules" class="rules" aria-labelledby="rules-heading" style="background-image: url('img/rules-bg.jpg');">
      <div class="overlay">
        <h2 id="rules-heading">ルール 要約</h2>
        <ul class="rules-list">
          <li><strong>思いやりを持つ</strong> 他プレイヤーへの嫌がらせや差別は禁止。</li>
          <li><strong>不正禁止</strong> チート・不正ツール・改造クライアントは禁止。</li>
          <li><strong>建築と所有</strong> 他人の建築物やチェストを尊重し、無断で破壊・窃盗しない。</li>
          <li><strong>ワールドルール厳守</strong> 各ワールドの専用ルールを守る。</li>
          <li><strong>荒らしは即対応</strong> 荒らし・スパム・悪質行為は警告なしでBAN対象。</li>
        </ul>
        <a class="btn" href="rules.html">ルール全文を見る</a>
      </div>
    </section>

    <!-- SERVER INFO（index用） -->
    <section id="server-info" class="server-info" aria-labelledby="serverinfo-heading" style="background-image:url('img/serverinfo-bg.jpg');background-size:cover;background-position:center;padding:20px;border-radius:12px;position:relative;">
    <div class="overlay" style="background:linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.25)); padding:18px; border-radius:10px; color:#fff;">
        <h2 id="serverinfo-heading" style="margin:0 0 12px 0">サーバー情報</h2>

        <div class="info-row" style="display:flex;gap:16px;flex-wrap:wrap">
        <div class="info-box" style="background:rgba(255,255,255,0.03);padding:12px;border-radius:8px;min-width:220px;">
            <h3 style="margin:0 0 8px 0">Java版</h3>
            <p class="mono" style="margin:4px 0">IP：<strong id="java-ip">読み込み中...</strong></p>
            <p class="mono" style="margin:4px 0">Port：<strong id="java-port">—</strong></p>
            <p class="note" style="margin-top:8px;color:#d1e7ff">バージョン：<span id="java-version">—</span></p>
        </div>

        <div class="info-box" style="background:rgba(255,255,255,0.03);padding:12px;border-radius:8px;min-width:220px;">
            <h3 style="margin:0 0 8px 0">統合版（Bedrock）</h3>
            <p class="mono" style="margin:4px 0">IP：<strong id="bedrock-ip">読み込み中...</strong></p>
            <p class="mono" style="margin:4px 0">Port：<strong id="bedrock-port">—</strong></p>
            <p class="note" style="margin-top:8px;color:#d1e7ff">バージョン：<span id="bedrock-version">—</span></p>
        </div>

        <div style="flex:1; min-width:260px; display:flex; flex-direction:column; justify-content:space-between;">
            <div style="background:rgba(255,255,255,0.02); padding:12px; border-radius:8px;">
            <div style="display:flex;justify-content:space-between;align-items:center">
                <div>
                <div style="font-weight:800" id="srv-name">サーバー名</div>
                <div style="color:#cfeff6" id="srv-location">所在地</div>
                </div>
                <div id="srv-status-badge" style="padding:6px 10px;border-radius:999px;background:#16a34a;color:#fff;font-weight:800">ONLINE</div>
            </div>

            <div style="margin-top:10px;color:#9fbfcf" id="srv-notes">接続補足・説明</div>
            </div>

            <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
            <a id="bluemap-link" class="btn btn-outline" href="https://bluemap.example.com" target="_blank" rel="noopener" style="padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.12);color:#fff;text-decoration:none;background:transparent">BlueMapを見る</a>
            <button id="copy-java-btn" class="btn btn-outline" style="padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.12);color:#fff;background:transparent">Java をコピー</button>
            <button id="copy-bedrock-btn" class="btn btn-outline" style="padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.12);color:#fff;background:transparent">Bedrock をコピー</button>
            </div>
        </div>
        </div>

        <!-- セクション内右下ボタン（セクションの右下に表示） -->
        <div class="section-actions" style="position:absolute;right:18px;bottom:18px;display:flex;gap:10px;z-index:5;">
        <button id="open-details" class="section-fab" style="padding:8px 12px;border-radius:999px;background:linear-gradient(90deg,#06b6d4,#10b981);color:#fff;border:none;cursor:pointer;font-weight:800">詳細情報</button>
        <button id="open-updates" class="section-fab ghost" style="padding:8px 12px;border-radius:999px;background:rgba(255,255,255,0.06);color:#e6f7f2;border:1px solid rgba(255,255,255,0.06);cursor:pointer;font-weight:800">アプデ情報</button>
        </div>
    </div>
    </section>

    <!-- モーダル（詳細 / アプデ） -->
    <div id="details-modal" class="modal-overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:12000;">
    <div class="modal-box" style="width:min(920px,96%);max-height:86vh;overflow:auto;background:#071827;color:#e6f7f2;border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.04);position:relative;">
        <button class="modal-close" id="details-close" aria-label="閉じる" style="position:absolute;right:18px;top:18px;background:transparent;border:none;color:#fff;font-size:20px;cursor:pointer">&times;</button>
        <h3 style="margin-top:0">サーバー詳細情報</h3>

        <div style="display:flex;gap:14px;flex-wrap:wrap">
        <div style="flex:1;min-width:260px">
            <div class="modal-section" style="background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;margin-bottom:10px;">
            <div style="font-weight:800">接続情報</div>
            <div style="margin-top:8px">
                <div><strong>Java</strong>： <span id="modal-java-addr">—</span></div>
                <div><strong>Bedrock</strong>： <span id="modal-bed-addr">—</span></div>
                <div style="margin-top:8px;color:#9fbfcf">クライアント / 対応</div>
                <div><span id="modal-client">—</span> ／ <span id="modal-compatible">—</span></div>
            </div>
            </div>

            <div class="modal-section" style="background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;margin-bottom:10px;">
            <div style="font-weight:800">運用情報</div>
            <div style="margin-top:8px">
                <div><strong>稼働状況</strong>： <span id="modal-status">—</span></div>
                <div><strong>プレイヤー上限</strong>： <span id="modal-maxplayers">—</span></div>
                <div><strong>ホワイトリスト</strong>： <span id="modal-whitelist">—</span></div>
                <div style="margin-top:8px;color:#9fbfcf">次回メンテ</div>
                <div id="modal-maint">—</div>
            </div>
            </div>

            <div class="modal-section" style="background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;">
            <div style="font-weight:800">接続補足 / 注意</div>
            <div id="modal-notes" style="margin-top:8px; white-space:pre-wrap">—</div>
            </div>
        </div>

        <aside style="width:320px;min-width:260px">
            <div class="modal-section" style="background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;margin-bottom:10px;">
            <div style="font-weight:800">リソース</div>
            <div style="margin-top:8px"><strong id="modal-mem">—</strong></div>
            <div style="margin-top:8px;color:#9fbfcf">CPU / コア</div>
            <div id="modal-cpu">—</div>
            <div style="margin-top:8px;color:#9fbfcf">ディスク / ネットワーク</div>
            <div id="modal-storage">—</div>
            </div>

            <div class="modal-section" style="background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;">
            <div style="font-weight:800">連絡先</div>
            <div style="margin-top:8px"><a id="modal-discord" href="#" target="_blank" rel="noopener" style="color:#bfeef0">Discord</a></div>
            <div style="margin-top:6px"><a id="modal-site" href="#" target="_blank" rel="noopener" style="color:#bfeef0">公式サイト</a></div>
            <div style="margin-top:6px;color:#9fbfcf">管理者</div>
            <div id="modal-contact">—</div>
            </div>
        </aside>
        </div>
    </div>
    </div>

    <div id="updates-modal" class="modal-overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:12000;">
    <div class="modal-box" style="width:min(920px,96%);max-height:86vh;overflow:auto;background:#071827;color:#e6f7f2;border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.04);position:relative;">
        <button class="modal-close" id="updates-close" aria-label="閉じる" style="position:absolute;right:18px;top:18px;background:transparent;border:none;color:#fff;font-size:20px;cursor:pointer">&times;</button>
        <h3 style="margin-top:0">アプデ情報</h3>
        <div id="modal-updates-list" style="margin-top:12px"></div>
    </div>
    </div>

    <script>
    (function(){
    const KEY = 'alpha_server_v1';
    const UPDATES_KEY = 'alpha_updates_v1';

    // display elements
    const javaIpEl = document.getElementById('java-ip');
    const javaPortEl = document.getElementById('java-port');
    const javaVerEl = document.getElementById('java-version');

    const bedIpEl = document.getElementById('bedrock-ip');
    const bedPortEl = document.getElementById('bedrock-port');
    const bedVerEl = document.getElementById('bedrock-version');

    const srvNameEl = document.getElementById('srv-name');
    const srvLocEl = document.getElementById('srv-location');
    const srvStatusBadge = document.getElementById('srv-status-badge');
    const srvNotesEl = document.getElementById('srv-notes');
    const bluemapLink = document.getElementById('bluemap-link');

    // copy buttons
    const copyJavaBtn = document.getElementById('copy-java-btn');
    const copyBedrockBtn = document.getElementById('copy-bedrock-btn');

    // modals
    const openDetailsBtn = document.getElementById('open-details');
    const openUpdatesBtn = document.getElementById('open-updates');
    const detailsModal = document.getElementById('details-modal');
    const detailsClose = document.getElementById('details-close');
    const updatesModal = document.getElementById('updates-modal');
    const updatesClose = document.getElementById('updates-close');

    // modal fields
    const modal = {
        javaAddr: document.getElementById('modal-java-addr'),
        bedAddr: document.getElementById('modal-bed-addr'),
        client: document.getElementById('modal-client'),
        compatible: document.getElementById('modal-compatible'),
        status: document.getElementById('modal-status'),
        maxplayers: document.getElementById('modal-maxplayers'),
        whitelist: document.getElementById('modal-whitelist'),
        maint: document.getElementById('modal-maint'),
        notes: document.getElementById('modal-notes'),
        mem: document.getElementById('modal-mem'),
        cpu: document.getElementById('modal-cpu'),
        storage: document.getElementById('modal-storage'),
        discord: document.getElementById('modal-discord'),
        site: document.getElementById('modal-site'),
        contact: document.getElementById('modal-contact'),
        updatesList: document.getElementById('modal-updates-list')
    };

    function loadServer(){
        try{ const raw = localStorage.getItem(KEY); return raw ? JSON.parse(raw) : {}; }catch(e){ return {}; }
    }
    function loadUpdates(){ try{ const raw = localStorage.getItem(UPDATES_KEY); return raw ? JSON.parse(raw) : []; }catch(e){ return []; } }

    function render(){
        const s = loadServer();

        // header info
        srvNameEl.textContent = s.name || 'サーバー名';
        srvLocEl.textContent = s.location || '';

        // status badge
        const st = s.status || 'online';
        srvStatusBadge.textContent = st === 'online' ? 'ONLINE' : (st === 'maintenance' ? 'MAINTENANCE' : 'OFFLINE');
        srvStatusBadge.style.background = st === 'online' ? '#16a34a' : (st === 'maintenance' ? '#f59e0b' : '#ef4444');

        srvNotesEl.textContent = s.notes || '';

        // Java
        const jIp = (s.java && s.java.ip) ? s.java.ip : '';
        const jPort = (s.java && s.java.port) ? s.java.port : '';
        javaIpEl.textContent = jIp || '未設定';
        javaPortEl.textContent = jPort || '—';
        javaVerEl.textContent = s.minecraftVersion || s.client || s.compatibleClients || 'どれでも可';

        // Bedrock
        const bIp = (s.bedrock && s.bedrock.ip) ? s.bedrock.ip : '';
        const bPort = (s.bedrock && s.bedrock.port) ? s.bedrock.port : '';
        bedIpEl.textContent = bIp || '未設定';
        bedPortEl.textContent = bPort || '—';
        bedVerEl.textContent = s.compatibleClients || 'どれでも可';

        // bluemap
        if(s.bluemap && s.bluemap.url){ bluemapLink.href = s.bluemap.url; bluemapLink.style.display = ''; }
    }

    // copy handlers
    copyJavaBtn.addEventListener('click', ()=>{
        const text = javaIpEl.textContent + (javaPortEl.textContent && javaPortEl.textContent !== '—' ? ':' + javaPortEl.textContent : '');
        if(!text || text.includes('未設定')) { alert('Java の接続情報が設定されていません'); return; }
        navigator.clipboard?.writeText(text).then(()=> { copyJavaBtn.textContent = 'コピーしました'; setTimeout(()=> copyJavaBtn.textContent = 'Java をコピー', 1200); }).catch(()=> alert('コピーに失敗しました'));
    });
    copyBedrockBtn.addEventListener('click', ()=>{
        const text = bedIpEl.textContent + (bedPortEl.textContent && bedPortEl.textContent !== '—' ? ':' + bedPortEl.textContent : '');
        if(!text || text.includes('未設定')) { alert('Bedrock の接続情報が設定されていません'); return; }
        navigator.clipboard?.writeText(text).then(()=> { copyBedrockBtn.textContent = 'コピーしました'; setTimeout(()=> copyBedrockBtn.textContent = 'Bedrock をコピー', 1200); }).catch(()=> alert('コピーに失敗しました'));
    });

    // modal open/close
    function openModal(el){ el.style.display = 'flex'; el.setAttribute('aria-hidden','false'); document.body.style.overflow = 'hidden'; }
    function closeModal(el){ el.style.display = 'none'; el.setAttribute('aria-hidden','true'); document.body.style.overflow = ''; }

    openDetailsBtn.addEventListener('click', ()=> { render(); openModal(detailsModal); });
    detailsClose.addEventListener('click', ()=> closeModal(detailsModal));
    detailsModal.addEventListener('click', (e)=> { if(e.target === detailsModal) closeModal(detailsModal); });

    openUpdatesBtn.addEventListener('click', ()=>{
        // fill updates modal
        const ups = loadUpdates();
        modal.updatesList.innerHTML = '';
        if(!ups || ups.length === 0){ modal.updatesList.innerHTML = '<div class="modal-section">投稿はありません。</div>'; }
        else {
        const sorted = ups.slice().sort((a,b)=> b.createdAt - a.createdAt);
        sorted.forEach(u=>{
            const wrap = document.createElement('div');
            wrap.className = 'modal-section';
            wrap.style.display = 'flex';
            wrap.style.gap = '10px';
            wrap.style.alignItems = 'flex-start';
            const img = document.createElement('img');
            img.src = u.image || '';
            img.alt = u.title || '';
            img.style.width = '120px'; img.style.height = '72px'; img.style.objectFit = 'cover'; img.style.borderRadius = '6px'; img.style.flex = '0 0 120px';
            const body = document.createElement('div'); body.style.flex = '1';
            const h = document.createElement('div'); h.style.fontWeight = '800'; h.textContent = u.title || '(無題)';
            const meta = document.createElement('div'); meta.style.color = '#9fbfcf'; meta.textContent = new Date(u.createdAt).toLocaleString();
            const p = document.createElement('div'); p.style.marginTop = '6px'; p.style.whiteSpace = 'pre-wrap'; p.textContent = u.description || '';
            body.appendChild(h); body.appendChild(meta); body.appendChild(p);
            wrap.appendChild(img); wrap.appendChild(body);
            modal.updatesList.appendChild(wrap);
        });
        }
        openModal(updatesModal);
    });
    updatesClose.addEventListener('click', ()=> closeModal(updatesModal));
    updatesModal.addEventListener('click', (e)=> { if(e.target === updatesModal) closeModal(updatesModal); });

    // initial render
    render();

    // storage sync
    window.addEventListener('storage', (e)=>{
        if(e.key === KEY) render();
        if(e.key === UPDATES_KEY && updatesModal.style.display === 'flex') {
        openUpdatesBtn.click();
        }
    });
    })();
    </script>


    <!-- PLUGIN GUIDE -->
    <section class="plugin-guide" aria-labelledby="plugin-heading">
      <h2 id="plugin-heading">プラグインの使い方</h2>
      <a class="plugin-btn" href="plugins.html" aria-label="プラグインの使い方へ">
        <div class="plugin-left">
          <img src="img/plugins-btn-bg.png" alt="" class="plugin-bg" aria-hidden="true">
        </div>
        <div class="plugin-right">
          <h3>プラグイン、コマンド</h3>
          <p>導入方法やFAQは省略。コマンドだけを簡潔に掲載しています。</p>
        </div>
      </a>
    </section>

    <!-- CONTACT -->
    <section class="contact" aria-labelledby="contact-heading">
      <h2 id="contact-heading">お問い合わせ</h2>
      <p>お問い合わせは <strong>Discordサーバー</strong> へお願いします。</p>
      <a class="btn ghost" href="https://discord.gg/your-discord" target="_blank" rel="noopener">Discordに参加する</a>
    </section>

  </main>

  <!-- SUPPORT BUTTON -->
  <a class="support-btn" href="donate.html" aria-label="支援する">支援する</a>

  <!-- JS: トップページ用ギャラリー（最新5件を表示、タップで gallery.html へ） -->
  <script>
    (function () {
      /* ---------- ギャラリー（既存） ---------- */
      const TOP_KEY = 'alpha_gallery_items_v1';
      const FALLBACK = [
        'img/gallery/1.jpg',
        'img/gallery/2.jpg',
        'img/gallery/3.jpg',
        'img/gallery/4.jpg',
        'img/gallery/5.jpg'
      ];
      const galleryContainer = document.getElementById('top-gallery');

      function loadSavedGallery() {
        try {
          const raw = localStorage.getItem(TOP_KEY);
          if (!raw) return [];
          return JSON.parse(raw);
        } catch (e) {
          return [];
        }
      }

      function buildLatestFive() {
        const saved = loadSavedGallery();
        saved.sort((a, b) => new Date(b.date) - new Date(a.date));
        const items = saved.slice(0, 5).map(i => ({ src: i.src, desc: i.desc || '' }));
        if (items.length < 5) {
          const used = new Set(items.map(i => i.src));
          for (let p of FALLBACK) {
            if (items.length >= 5) break;
            if (!used.has(p)) {
              items.push({ src: p, desc: '' });
              used.add(p);
            }
          }
        }
        return items;
      }

      function renderTopGallery() {
        if (!galleryContainer) return;
        galleryContainer.innerHTML = '';
        const items = buildLatestFive();
        if (items.length === 0) {
          const p = document.createElement('p');
          p.textContent = 'まだ画像が登録されていません。管理画面から追加してください。';
          galleryContainer.appendChild(p);
          return;
        }
        items.forEach((it) => {
          const link = document.createElement('a');
          link.href = 'gallery.html';
          link.className = 'top-thumb';
          link.setAttribute('aria-label', it.desc || 'ギャラリーを開く');

          const img = document.createElement('img');
          img.src = it.src;
          img.alt = it.desc || 'ギャラリー画像';
          img.loading = 'lazy';

          const caption = document.createElement('div');
          caption.className = 'top-thumb-desc';
          caption.textContent = it.desc || '';

          link.appendChild(img);
          link.appendChild(caption);
          galleryContainer.appendChild(link);
        });
      }

      renderTopGallery();
      window.addEventListener('storage', (e) => {
        if (e.key === TOP_KEY) renderTopGallery();
      });

      /* ---------- 直近イベント（新規） ---------- */
      const EVENTS_KEY = 'alpha_events_v1';
      const eventsContainer = document.getElementById('event-list');

      function loadEvents() {
        try {
          const raw = localStorage.getItem(EVENTS_KEY);
          if (!raw) return [];
          return JSON.parse(raw);
        } catch (e) {
          return [];
        }
      }

      function isUpcoming(ev) {
        const now = new Date();
        const start = new Date(ev.start);
        const end = ev.end ? new Date(ev.end) : null;
        // upcoming if end >= now OR start >= now OR currently ongoing
        if (end && end >= now) return true;
        if (start >= now) return true;
        if (start <= now && (!end || end >= now)) return true;
        return false;
      }

      function renderLatestThreeEvents() {
        if (!eventsContainer) return;
        eventsContainer.innerHTML = '';
        const all = loadEvents();
        if (!all || all.length === 0) {
          const p = document.createElement('p');
          p.textContent = '直近のイベントはまだ登録されていません。';
          eventsContainer.appendChild(p);
          return;
        }

        // separate upcoming (開催中/これから) and past
        const upcoming = all.filter(isUpcoming).sort((a,b)=> new Date(a.start) - new Date(b.start));
        const past = all.filter(ev => !isUpcoming(ev)).sort((a,b)=> new Date(b.start) - new Date(a.start));

        // combine: upcoming first, then past; take first 3
        const combined = upcoming.concat(past).slice(0,3);

        combined.forEach(ev => {
          const card = document.createElement('article');
          card.className = 'event-card';
          card.tabIndex = 0;

          const img = document.createElement('img');
          img.src = ev.thumb || 'img/event-thumb-1.png';
          img.alt = ev.title || 'イベント';
          img.className = 'event-thumb';

          const body = document.createElement('div');
          body.className = 'event-body';
          const title = document.createElement('h3');
          title.className = 'event-title';
          title.textContent = ev.title || 'イベント';
          const desc = document.createElement('p');
          desc.className = 'event-desc';
          desc.textContent = ev.desc ? (ev.desc.length > 80 ? ev.desc.slice(0,80) + '…' : ev.desc) : '';

          body.appendChild(title);
          body.appendChild(desc);

          card.appendChild(img);
          card.appendChild(body);

          // click -> events.html (詳細は events.html で)
          card.addEventListener('click', ()=> { window.location.href = 'events.html'; });
          card.addEventListener('keypress', (e)=> { if(e.key === 'Enter') window.location.href = 'events.html'; });

          eventsContainer.appendChild(card);
        });
      }

      renderLatestThreeEvents();
      window.addEventListener('storage', (e) => {
        if (e.key === EVENTS_KEY) renderLatestThreeEvents();
      });

    })();
  </script>

</body>
</html>これに対応されない、原因は？