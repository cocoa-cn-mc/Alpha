<!DOCTYPE html>
<html lang="ja">
<head>
      <!-- favicon -->
    <link rel="icon" type="image/png" href="img/favicon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
    <meta name="msapplication-TileColor" content="#2b8a3e">
    <meta name="theme-color" content="#2b8a3e">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ワールド情報 - α鯖</title>
    <style>
    :root{--accent:#2b8a3e;--muted:#6b7280;--bg:#f6f8fa;--card:#fff;--maxw:1100px}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Noto Sans JP",sans-serif;background:var(--bg);color:#111}
    header{background:linear-gradient(180deg,#0b1220,#0f172a);color:#fff;padding:20px;text-align:center}
    main{max-width:var(--maxw);margin:20px auto;padding:18px}
    .selector{display:flex;gap:12px;align-items:center;justify-content:center;margin-bottom:18px}
    select{padding:8px;border-radius:8px;border:1px solid #e6eef6}
    .world-card{background:rgba(255,255,255,0.9);padding:18px;border-radius:12px;border:1px solid #e6eef6}
    .world-title{margin:0;font-size:1.4rem}
    .world-desc{color:var(--muted);margin-top:6px}
    .chapters{margin-top:16px;display:flex;flex-direction:column;gap:12px}
    .chapter{display:flex;gap:12px;align-items:flex-start;background:rgba(255,255,255,0.95);padding:12px;border-radius:10px;border:1px solid #eef2f6}
    .chapter .img{width:320px;flex:0 0 320px}
    .chapter img{width:100%;height:auto;border-radius:8px;display:block}
    .chapter .content{flex:1}
    .chapter h3{margin:0 0 6px 0}
    .note{color:var(--muted);font-size:0.95rem}
    /* background fixed container: apply to body via inline style when world selected */
    @media (max-width:900px){
      .chapter{flex-direction:column}
      .chapter .img{width:100%;flex:0 0 auto}
    }
  </style>
</head>
<body>
    <header class="site-banner" role="banner" style="width:100%;background:linear-gradient(90deg,#0f172a,#0b1220);color:#fff;position:sticky;top:0;z-index:1000;box-shadow:0 2px 6px rgba(0,0,0,0.2);">
    <a href="#main-content" class="skip-link" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">コンテンツへスキップ</a>

    <div class="banner-inner" style="max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:10px 16px;gap:12px;box-sizing:border-box;">
        <!-- 左グループ -->
        <div class="left-group" style="display:flex;gap:8px;align-items:center;">
        <a href="https://discord.gg/m3tSJ3QCVP" target="_blank" rel="noopener noreferrer" aria-label="Discord" style="display:inline-flex;align-items:center;gap:8px;color:#e6eef8;text-decoration:none;padding:6px 10px;border-radius:6px;font-weight:600;font-size:14px;">
            <!-- 必要ならここにSVG -->
            <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" style="display:block;fill:currentColor;"><!-- ... --></svg>
            <span>Discord</span>
        </a>


        </div>

        <!-- 中央ブランド -->
        <div class="brand" style="display:flex;align-items:center;gap:8px;margin:auto;">
        <img src="./img/server-icon.png" alt="α鯖アイコン" class="brand-icon" style="width:36px;height:36px;">
        <span class="brand-text" style="font-size:18px;font-weight:800;color:#fff;">α鯖</span>
        </div>

        <!-- 右グループ（ナビ） -->
        <nav class="right-group" role="navigation" aria-label="サイトナビゲーション" style="display:flex;align-items:center;gap:12px;">
        <button class="hamburger" aria-expanded="false" aria-controls="nav-list" aria-label="メニュー" style="display:none;background:none;border:0;padding:6px;cursor:pointer;">
            <span style="display:block;width:20px;height:2px;background:#fff;margin:4px 0;border-radius:2px;"></span>
            <span style="display:block;width:20px;height:2px;background:#fff;margin:4px 0;border-radius:2px;"></span>
            <span style="display:block;width:20px;height:2px;background:#fff;margin:4px 0;border-radius:2px;"></span>
        </button>

        <ul id="nav-list" class="nav-list" aria-hidden="true" style="display:flex;gap:10px;list-style:none;margin:0;padding:0;align-items:center;">
            <li><a href="./index.html" class="nav-link" style="color:#dbeafe;text-decoration:none;padding:8px 10px;border-radius:6px;font-weight:600;">トップ</a></li>
            <li><a href="./events.html" class="nav-link" style="color:#dbeafe;text-decoration:none;padding:8px 10px;border-radius:6px;font-weight:600;">イベント</a></li>
            <li><a href="./gallery.html" class="nav-link" style="color:#dbeafe;text-decoration:none;padding:8px 10px;border-radius:6px;font-weight:600;">ギャラリー</a></li>
            <li><a href="./plugins.html" class="nav-link" style="color:#dbeafe;text-decoration:none;padding:8px 10px;border-radius:6px;font-weight:600;">プラグイン</a></li>
            <li><a href="./rules.html" class="nav-link" style="color:#dbeafe;text-decoration:none;padding:8px 10px;border-radius:6px;font-weight:600;">ルール</a></li>
            <li><a href="./worlds.html" class="nav-link" style="color:#dbeafe;text-decoration:none;padding:8px 10px;border-radius:6px;font-weight:600;">ワールド</a></li>
            <li><a href="./donate.html" class="nav-link donate" style="background:linear-gradient(90deg,#ff7a18,#ff3d00);color:#fff;padding:8px 12px;border-radius:8px;font-weight:700;text-decoration:none;box-shadow:0 2px 8px rgba(255,61,0,0.2);">寄付</a></li>
        </ul>
        </nav>
    </div>
    </header>
  <header>
    <h1>ワールド情報</h1>
    <p style="margin:6px 0 0;opacity:0.9">上部でワールドを切り替えて、章ごとの説明と画像を確認できます。</p>
  </header>

  <main>
    <div class="selector">
      <label for="world-select" style="color:#fff;background:var(--accent);padding:8px 10px;border-radius:8px">ワールド選択</label>
      <select id="world-select"></select>
    </div>

    <div id="world-container"></div>
  </main>

  <script>
    (function(){
      const STORAGE_KEY = 'alpha_worlds_v1';
      const selectEl = document.getElementById('world-select');
      const container = document.getElementById('world-container');

      function load(){
        try{
          const raw = localStorage.getItem(STORAGE_KEY);
          return raw ? JSON.parse(raw) : [];
        }catch(e){ return []; }
      }

      function renderSelector(worlds){
        selectEl.innerHTML = '';
        if(worlds.length === 0){
          const opt = document.createElement('option'); opt.value=''; opt.textContent='ワールドが登録されていません';
          selectEl.appendChild(opt);
          renderEmpty();
          return;
        }
        worlds.forEach((w, idx)=>{
          const opt = document.createElement('option'); opt.value = w.id; opt.textContent = w.name || ('ワールド ' + (idx+1));
          selectEl.appendChild(opt);
        });
        // restore last selected if any
        const last = localStorage.getItem('alpha_worlds_selected');
        if(last && worlds.find(w=>w.id===last)) selectEl.value = last;
        else selectEl.selectedIndex = 0;
        renderWorldById(selectEl.value, worlds);
      }

      function renderEmpty(){
        container.innerHTML = '<div class="world-card"><div class="note">管理者がワールドを追加するとここに表示されます。</div></div>';
        document.body.style.backgroundImage = '';
        document.body.style.backgroundAttachment = '';
      }

      function renderWorldById(id, worlds){
        const w = worlds.find(x=>x.id===id);
        if(!w){ renderEmpty(); return; }
        // set fixed background
        if(w.background){
          document.body.style.backgroundImage = `url('${w.background}')`;
          document.body.style.backgroundAttachment = 'fixed';
          document.body.style.backgroundSize = 'cover';
          document.body.style.backgroundPosition = 'center';
        } else {
          document.body.style.backgroundImage = '';
          document.body.style.backgroundAttachment = '';
        }

        // build content
        const html = [];
        html.push(`<div class="world-card">`);
        html.push(`<h2 class="world-title">${escapeHtml(w.name)}</h2>`);
        if(w.desc) html.push(`<div class="world-desc">${escapeHtml(w.desc)}</div>`);
        if(w.longDesc) html.push(`<div style="margin-top:8px;white-space:pre-wrap">${escapeHtml(w.longDesc)}</div>`);
        html.push(`<div class="chapters">`);
        (w.chapters || []).forEach((c, idx)=>{
          html.push(`<div class="chapter">`);
          if(c.image){
            html.push(`<div class="img"><img src="${c.image}" alt="${escapeHtml(c.title||'章')}"></div>`);
          } else {
            html.push(`<div class="img" style="display:none"></div>`);
          }
          html.push(`<div class="content"><h3>${escapeHtml(c.title || ('第'+(idx+1)+'章'))}</h3>`);
          html.push(`<div style="white-space:pre-wrap">${escapeHtml(c.content || '')}</div></div>`);
          html.push(`</div>`);
        });
        html.push(`</div></div>`);
        container.innerHTML = html.join('');
        // persist selection
        localStorage.setItem('alpha_worlds_selected', id);
      }

      function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

      // init
      const worlds = load();
      renderSelector(worlds);

      selectEl.addEventListener('change', ()=>{
        const worlds2 = load();
        renderWorldById(selectEl.value, worlds2);
      });

      // listen for storage changes (other tab edits)
      window.addEventListener('storage', (e)=>{
        if(e.key === STORAGE_KEY){
          const ws = load();
          renderSelector(ws);
        }
      });

    })();
  </script>
</body>
</html>
